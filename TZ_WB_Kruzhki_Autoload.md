Название
- Модуль подготовки карточек «Кружки» для Wildberries: загрузка фото в Яндекс.Диск и генерация XLSX из плоской папки.

Цель
- Упростить массовую подготовку карточек: загрузить фото в Яндекс.Диск, получить публичные прямые ссылки и сформировать XLSX по шаблону WB с заполненными полями (SKU, цена, описание, характеристики, фото).

Область и контекст
- Категория: «Кружки» и подвиды («для мам», «для пап», …).
- Источник фото: одна локальная папка (плоская структура).
- Облако: Яндекс.Диск (публикация файлов и получение прямых ссылок).
- Выгрузка: один XLSX-файл по вашему шаблону (см. маппинг колонок ниже).
- Среда: Windows 10/11. Поставка — один .exe.

Главные сценарии
1) Оператор выбирает профайл параметров (общие значения для серии).
2) Указывает папку с фото (плоская), программа группирует фото в товары по имени файла.
3) Вводит/импортирует цену, баркод и др. индивидуальные поля (по SKU).
4) Авторизуется в Яндекс.Диске, выбирает корневую облачную папку.
5) Старт: модуль создает папки /{SKU}/, загружает фото, публикует и получает прямые ссылки.
6) Генерирует XLSX с заполнением согласованных колонок, сохраняет файл и отчёт.

Правило группировки фото (плоская папка)
- Имя файла: {sku}.{n}.{ext}
  - sku — идентификатор товара (например, mama_1)
  - n — порядковый номер фото (1,2,3,…)
  - ext — jpg/jpeg/png (регистронезависимо)
- Примеры: mama_1.1.jpg, mama_1.2.jpg → SKU mama_1; mama_2.1.png → SKU mama_2.
- Порядок фото — по числу n.
- Нераспознанные расширения/файлы — игнорируются (в отчёте предупреждения).
- Дубликат номера (две «.1») — предупреждение, выбор файла пользователем.
- Пропуски номеров — предупреждение, продолжаем.
- Настраиваемый паттерн (опция): регулярка с группами (?P<sku>), (?P<n>).
  - По умолчанию: ^(?P<sku>.+)\.(?P<n>\d+)\.(?P<ext>jpe?g|png)$

Интеграция с Яндекс.Диском
- OAuth-токен (вводится один раз, хранится локально безопасно).
- Для каждого SKU создается папка /{корень}/{SKU}/.
- Загрузка фото; публикация; получение прямого download-URL (не страницы просмотра).
- Идемпотентность: при повторном запуске — пропуск уже загруженных (по имени+размеру) или перезапись по настройке.
- Ретраи при сетевых сбоях, таймауты, лимит параллельных загрузок.

Генерация XLSX (по вашему маппингу)
- Колонка «Фото»: один столбец, в ячейке — все ссылки через «;» в порядке 1..N.
- Мастер сопоставления полей: хранится в профиле, чтобы выдерживать обновления шаблона.
- Автозаполнение колонок (источники данных):
  - A Артикул продавца — из SKU (например, mama_1)
  - B Наименование — из шаблона профиля или вручную/импорт (поддержка подстановок {sku}, {volume} и т.п.)
  - C Бренд — из профиля (константа)
  - D Описание — из профиля (шаблон текста)
  - E Фото — публичные ссылки из Я.Диска (склеены «;»)
  - F Видео — из профиля (список ссылок «;») или пусто
  - G КИЗ — из профиля/импорта или пусто
  - H Пол — из профиля (например, «унисекс»)
  - I Состав — из профиля (например, «керамика 100%»)
  - J Цвет — из профиля или индивидуально (по SKU)
  - K Баркод — из импорта sku→barcode или пусто
  - L Размер — из профиля (например, «универсальный») — подтвердить
  - M Рос. размер — из профиля (например, «универсальный») — подтвердить
  - N Цена — из профиля (единая) или импорт sku→price или ручной ввод
  - O Ставка НДС — из профиля (по умолчанию «20%») — подтвердить
  - P Вес с упаковкой (г) — из профиля (число)
  - Q Высота упаковки — из профиля (единицы — см или мм; подтвердить)
  - R Длина упаковки — из профиля (единицы — подтвердить)
  - S Ширина упаковки — из профиля (единицы — подтвердить)
  - T Дата окончания действия декларации — из профиля/импорта или пусто
  - U Дата регистрации декларации — из профиля/импорта или пусто
  - V Номер декларации соответствия — из профиля/импорта или пусто
  - W Номер сертификата соответствия — из профиля/импорта или пусто
  - X Возрастные ограничения (18+) — из профиля («Да/Нет»; по умолчанию «Нет»)
  - Y Группа — не автозаполняем (ручной ввод/оставляем пусто)
  - Z Артикул WB — не автозаполняем (обычно появляется после модерации)
  - AA Категория продавца — не автозаполняем (можем сделать константой профиля по запросу)
  - AB Вес с упаковкой (кг) — не автозаполняем; опция: считать из граммов (P/1000) с округлением
  - AC–AU Прочие — не используем
- Если в будущей версии шаблона появятся «Фото 1…Фото N», модуль может заполнять поколоночно.

Профили параметров (набор констант)
- Можно хранить несколько профилей («для мам», «для пап», …).
- Поля профиля (минимум): бренд, шаблон наименования, шаблон описания, пол, состав, цвет (если общий), ставка НДС, вес с упаковкой (г), габариты (В/Д/Ш), возрастные ограничения, предмет/категория WB (если требуется в шаблоне), разделитель ссылок «Фото», максимум фото, корневая папка на Я.Диске.
- Дополнительно по желанию: категория продавца (AA), автосчёт «вес (кг)» из граммов.

Импорт/редактирование данных
- Импорт CSV/XLSX: sku, price, barcode, color, name — по необходимости.
- Редактирование в GUI: таблица товаров (SKU, цена, баркод, имя, кол-во фото, статус).
- Предпросмотр: как распарсились файлы, какие ссылки будут вставлены.

Валидации и правила
- Проверка обязательных полей перед сохранением XLSX (по текущему шаблону).
- Проверка формата и достижимости ссылок (HTTP 200).
- Проверка типов/диапазонов для числовых полей (вес, габариты, цена).
- Проверка формата дат деклараций/сертификатов (ДД.ММ.ГГГГ или как в шаблоне).
- Проверка кол-ва фото ≤ заданного лимита (по умолчанию 6); при превышении — предупреждение и отсечение/запрет по настройке.

Обработка изображений (опционально)
- Конвертация в JPG и сжатие (качество настраиваемое).
- Приведение сторон/размера под рекомендуемые для WB (если предоставите нормы).
- Сохранение исходных имён для устойчивых ссылок.

Интерфейс (основное)
- Главный экран: выбор профиля, выбор папки с фото, предпросмотр групп SKU→фото, импорт цен/штрихкодов, настройки Я.Диска (токен, корень), кнопки «Старт», «Сохранить XLSX», «Экспорт отчёта».
- Карточка товара (по клику): SKU, цена, баркод, имя; миниатюры фото с drag&drop для порядка; исключение фото/замена.
- Мастер маппинга колонок: один раз подтверждаете соответствие названий в вашей версии шаблона.
- Прогресс-бар и лог событий.

Отчётность и логи
- Отчёт CSV/Excel: sku, локальные файлы, облачные URL, результат, сообщения об ошибках/предупреждениях.
- Логи операций с отметками времени; экспорт по запросу.

Безопасность
- Токен Я.Диска хранится локально в зашифрованном виде (привязка к учётной записи Windows).
- В логах не пишем секреты и токены.

Нефункциональные требования
- Производительность: целевой пакет — до 500 SKU × 6 фото (≈3000 файлов). Параллельная загрузка с ограничением, чтобы не упираться в лимиты API и канал.
- Отказоустойчивость: ретраи, таймауты, продолжение после сбоя, идемпотентность.
- Поставка: один .exe (PyInstaller). Не требует установленного Python.

Критерии приемки
- На тестовом наборе (≥3 SKU, по 5–6 фото):
  - Фото загружены в Я.Диск в /{SKU}/, доступны по публичным прямым ссылкам.
  - Сформирован XLSX, все обязательные поля заполнены, «Фото» содержит рабочие ссылки в правильном порядке.
  - Файл успешно проходит предварительную валидацию и импорт в ЛК WB без критических ошибок формата.
  - Повторный запуск не создаёт дублей в облаке (по настройке пропуск/перезапись).
  - Отчёт содержит полный трекинг, ошибки отражены.

Ограничения и допущения
- «Фото» — один столбец со списком ссылок, разделённых «;» (можно изменить в настройках).
- Поля Y (Группа), Z (Артикул WB), AA (Категория продавца), AB (Вес с упаковкой, кг) — по умолчанию не заполняются; AB может рассчитываться из P по опции.
- Значения для размеров/веса/НДС/деклараций предоставляет заказчик (константы в профиле или импорт).
- Допустимые форматы фото: jpg/jpeg/png.

Открытые вопросы для финализации (подтвердить)
- Разделитель ссылок в «Фото»: «;» верно?
- Макс. число фото на карточку: 6?
- Единицы габаритов в Q/R/S (Высота/Длина/Ширина): см или мм?
- Значения по умолчанию: НДС 20%, Размер/Рос. размер — «универсальный»?
- Бар-коды: предоставляете таблицу sku→barcode, или оставляем пусто?
- Заполнять «Категория продавца» (AA) константой профиля?
- Включаем автосчёт «Вес с упаковкой (кг)» = P/1000?

План работ и сроки
- 0.5–1 рабочий день после подтверждения открытых вопросов и получения тестового набора (2–3 SKU с фото).
- Демонстрация прототипа, приёмочные правки — в тот же/следующий день.

Поставляемые артефакты
- Исполняемый файл .exe.
- Образец файла профиля (константы/шаблоны).
- Образец файла маппинга колонок.
- Короткая инструкция пользователя (PDF/MD).